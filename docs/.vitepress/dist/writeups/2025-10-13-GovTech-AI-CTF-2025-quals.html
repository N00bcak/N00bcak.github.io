<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GovTech AI CTF 2025 (Quals) Writeups | N00bcak's Purple Cave</title>
    <meta name="description" content="Blogging Things When I Feel Like It">
    <meta name="generator" content="VitePress v2.0.0-alpha.15">
    <link rel="preload stylesheet" href="/assets/style.J3FZYP_c.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app._rTD6Zcy.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.Bwe-6f2d.js">
    <link rel="modulepreload" href="/assets/chunks/framework.DsG8PLbD.js">
    <link rel="modulepreload" href="/assets/writeups_2025-10-13-GovTech-AI-CTF-2025-quals.md.6cLPK43v.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-1df9f90f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-331ec75c></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-331ec75c>Skip to content</a><!--]--><!----><header class="VPNav" data-v-1df9f90f data-v-da52a441><div class="VPNavBar" data-v-da52a441 data-v-70946a35><div class="wrapper" data-v-70946a35><div class="container" data-v-70946a35><div class="title" data-v-70946a35><div class="VPNavBarTitle" data-v-70946a35 data-v-1e38c6bc><a class="title" href="/" data-v-1e38c6bc><!--[--><!--]--><!----><span data-v-1e38c6bc>N00bcak&#39;s Purple Cave</span><!--[--><!--]--></a></div></div><div class="content" data-v-70946a35><div class="content-body" data-v-70946a35><!--[--><!--]--><div class="VPNavBarSearch search" data-v-70946a35><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-70946a35 data-v-39714824><span id="main-nav-aria-label" class="visually-hidden" data-v-39714824> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about-me.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>About</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/writeups.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>CTF Writeups</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>Blog</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-70946a35 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-70946a35 data-v-0394ad82 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/N00bcak" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-70946a35 data-v-bf2fac68 data-v-42cb505d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-42cb505d><span class="vpi-more-horizontal icon" data-v-42cb505d></span></button><div class="menu" data-v-42cb505d><div class="VPMenu" data-v-42cb505d data-v-25a6cce8><!----><!--[--><!--[--><!----><div class="group" data-v-bf2fac68><div class="item appearance" data-v-bf2fac68><p class="label" data-v-bf2fac68>Appearance</p><div class="appearance-action" data-v-bf2fac68><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bf2fac68 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bf2fac68><div class="item social-links" data-v-bf2fac68><div class="VPSocialLinks social-links-list" data-v-bf2fac68 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/N00bcak" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-70946a35 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-70946a35><div class="divider-line" data-v-70946a35></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-1df9f90f data-v-db738f89><div class="container" data-v-db738f89><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-db738f89 data-v-0bf0e06f><button data-v-0bf0e06f>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-1df9f90f data-v-c87f25bf><div class="VPDoc has-aside" data-v-c87f25bf data-v-7011f0d8><!--[--><!--]--><div class="container" data-v-7011f0d8><div class="aside" data-v-7011f0d8><div class="aside-curtain" data-v-7011f0d8></div><div class="aside-container" data-v-7011f0d8><div class="aside-content" data-v-7011f0d8><div class="VPDocAside" data-v-7011f0d8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-60d5052e><div class="content" data-v-60d5052e><div class="outline-marker" data-v-60d5052e></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-60d5052e>On this page</div><ul class="VPDocOutlineItem root" data-v-60d5052e data-v-1ce71065><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-7011f0d8><div class="content-container" data-v-7011f0d8><!--[--><!--[--><!--[--><h1 id="title">GovTech AI CTF 2025 (Quals) Writeups</h1><!--]--><!--]--><!--]--><main class="main" data-v-7011f0d8><div style="position:relative;" class="vp-doc _writeups_2025-10-13-GovTech-AI-CTF-2025-quals" data-v-7011f0d8><div><p>So I fancied coming back to do writeups after a 4-year hiatus.</p><p>This CTF was apparently very easy to one-shot with GPT Plus, and I&#39;m pretty sure none of the top 10 teams solved a majority of the challenges without LLM assistance.</p><p>However, I had quite a few interesting concepts and challenges that I found fun to solve (notably, WITHOUT resorting to LLM chatbots). Let&#39;s go.</p><h1 id="writeups" tabindex="-1">Writeups <a class="header-anchor" href="#writeups" aria-label="Permalink to “Writeups”">​</a></h1><ol><li><a href="#stridesafe">StrideSafe</a></li><li><a href="#limit-theory">Limit Theory</a></li></ol><h2 id="stridesafe" tabindex="-1">StrideSafe <a class="header-anchor" href="#stridesafe" aria-label="Permalink to “StrideSafe”">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula" style="--shiki-light:#24292e;--shiki-dark:#F8F8F2;--shiki-light-bg:#fff;--shiki-dark-bg:#282A36;" tabindex="0" dir="ltr"><code><span class="line"><span>Singapore&#39;s lamp posts are getting smarter. They don&#39;t just light the way -- they watch over the pavements.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Your next-gen chip has been selected for testing. Can your chip distinguish pedestrians from bicycles and PMDs (personal mobility devices)?</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Pass the test, and your chip will earn deployment on Singapore&#39;s smart lamp posts. Fail, and hazards roam free on pedestrian walkways.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="reconnaissance" tabindex="-1">Reconnaissance <a class="header-anchor" href="#reconnaissance" aria-label="Permalink to “Reconnaissance”">​</a></h3><p>We are given a zip file containing a 1k 64x64 RGB images. Conspicuously missing are any image labels, leading me to think that:</p><ol><li>This is an <a href="#trying-unsupervised-learning">unsupervised learning challenge</a></li><li>The challenge wants us to <a href="#trying-inference">run inference</a>.</li></ol><p>While I can tell you right now that <a href="#trying-inference">method 2</a> gave us the flag,<br> but since this was a LLM-less attempt... let&#39;s just say I wasted a lot of time on <a href="#trying-unsupervised-learning">method 1</a>. So I&#39;m going to waste YOUR time too &gt;:D</p><h3 id="trying-unsupervised-learning" tabindex="-1">Trying Unsupervised Learning <a class="header-anchor" href="#trying-unsupervised-learning" aria-label="Permalink to “Trying Unsupervised Learning”">​</a></h3><p><img src="/assets/stridesafe-pictures.BMTA_Xm_.png" alt="" data-zoomable="true"></p><p>As mentioned above, there were no image labels. So my first instinct was to perform a quick PCA + K-Means clustering to see if the images could be grouped into 2 distinct clusters (people vs bicycles/PMDs).</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light dracula" style="--shiki-light:#24292e;--shiki-dark:#F8F8F2;--shiki-light-bg:#fff;--shiki-dark-bg:#282A36;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># This was done on a Jupyter notebook, so the code snippets are kind of scattered. Sorry!</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> glob</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> PIL</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> Image</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> matplotlib </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pyplot </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> plt</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Retrieve all the images and put them into shapes.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">image_files </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> glob.glob(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">data/*.jpg</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># for img_path in image_files:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">#     img = Image.open(img_path)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">#     img = img.convert(&quot;RGB&quot;)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">dummy_path </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;"> next</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">iter</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(image_files), </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">dummy_image </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np.array(Image.open(dummy_path)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> dummy_path </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">else</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> None</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(dummy_image.shape)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.imshow(dummy_image)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">### New cell</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> polars </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> einops</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">image_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> img_path </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> image_files:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    img </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> Image.open(img_path)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    img_array </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np.array(img)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    img_array </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> einops.rearrange(img_array, </span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">h w c -&gt; (h w c)</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    image_data.append(img_array)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">df </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl.from_numpy(np.array(image_data))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(df.head())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">file_names </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> [img_path.split(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)[</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> img_path </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> image_files]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">df </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> df.with_columns(pl.Series(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">file_name</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, file_names))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">df.write_csv(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">images.csv</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">### New cell</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sklearn.decomposition </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> PCA</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sklearn.neighbors </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> NearestNeighbors</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sklearn.manifold </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> TSNE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sklearn.cluster </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> KMeans, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">DBSCAN</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sklearn.preprocessing </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> StandardScaler</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Load the CSV file</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">df </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl.read_csv(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">images.csv</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">X </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> df.drop(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">file_name</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).to_numpy()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Scale and do dim reduction.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">scaler </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> StandardScaler()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">scaled_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> scaler.fit_transform(X)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">pca </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> PCA(</span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">n_components</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">pca_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pca.fit_transform(scaled_data)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;PCA reduced data shape: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">pca_result.shape</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># print(f&quot;Good threshold for number of components: {np.sum(pca.explained_variance_ratio_ &gt;)}&quot;)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;Explained variance ratios: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">pca.explained_variance_ratio_</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">thresh </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np.sum(pca.explained_variance_ratio_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 0.01</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;Good threshold for number of components: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">thresh</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;Total explained variance for </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">thresh</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;"> components: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">np.sum(pca.explained_variance_ratio_[</span><span style="--shiki-light:#24292E;--shiki-dark:#FF79C6;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">thresh])</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># (1089, 12288)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># PCA reduced data shape: (1089, 100)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Explained variance ratios: &lt;omitted for sanity&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Good threshold for number of components: 12</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Total explained variance for 12 components: 0.7005721540268107</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">### New cell</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Use K-Means clustering</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">kmeans </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> KMeans(</span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">n_clusters</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">random_state</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">max_iter</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">labels </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> kmeans.fit_transform(pca_result)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;K-Means labels shape: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">labels.shape</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.scatter(labels[</span><span style="--shiki-light:#24292E;--shiki-dark:#FF79C6;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">], labels[</span><span style="--shiki-light:#24292E;--shiki-dark:#FF79C6;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">], </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">c</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">kmeans.labels_, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">cmap</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">viridis</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.title(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">K-Means Clustering of Image Data</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.xlabel(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">K-Means Component 1</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.ylabel(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">K-Means Component 2</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.show()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">df_labels </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl.DataFrame(kmeans.labels_, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">label</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">pl.concat([df_labels, df[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">file_name</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">].to_frame()], </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">how</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;"> &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">horizontal</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).write_csv(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">results.csv</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><p>yields a relatively clean clustering of the images into 2 groups: <img src="/assets/kmeans-plot.BaaVTxrc.png" alt="" data-zoomable="true"></p><p>The classification, however, was a lot less clean...</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light dracula" style="--shiki-light:#24292e;--shiki-dark:#F8F8F2;--shiki-light-bg:#fff;--shiki-dark-bg:#282A36;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">results </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl.read_csv(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">results.csv</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).sort(</span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">by</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;"> &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">file_name</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">label</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">].to_list()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">results_arr </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np.array(results)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">size </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-light-font-style:inherit;--shiki-dark:#8BE9FD;--shiki-dark-font-style:italic;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(np.sqrt(</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(results_arr)))     </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.figure(</span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">figsize</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.imshow(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> results_arr.reshape((size, size)), </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">cmap</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">gray</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.axis(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">off</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.show()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAD7CAYAAABDsImYAAAAOnRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjEwLjMsIGh0dHBzOi8vbWF0cGxvdGxpYi5vcmcvZiW1igAAAAlwSFlzAAAPYQAAD2EBqD+naQAABe1JREFUeJzt3ctu5EgSAEFpsP//y5pTHwZYUNUUMxVZbnZXvR0EOjqYn19fX18fwFv757dfALCe0CFA6BAgdAgQOgQIHQKEDgFChwChQ8D/nniQz8/PJx7mP67+w97V8939j34r3sNdd9/73cfcbfd7uPt7WfF3V1Z+R67oECB0CBA6BAgdAoQOAUKHgE83nviZ3SOYU5wyfpr0PRivAT8idAgQOgQIHQKEDgFCh4BHtteunDJK2b0tt3sTa4Wr1/LuY8fTtt5c0SFA6BAgdAgQOgQIHQKEDgEvj9fujgwmLcftHqFdmTQmW+GUseMpNxP96W/CFR0ChA4BQocAoUOA0CFA6BDwqzeHPGVT6a5JZ4VdmTTOm3SO34rnu2J7DfgRoUOA0CFA6BAgdAgQOgQs3147ZVS0e9T3Dp/LpG3A3Va895VjQFd0CBA6BAgdAoQOAUKHAKFDwCPba5NGRSvGOpNuHLnbxE2sJ5/vrknn3NleAz4+PoQOCUKHAKFDgNAhQOgQ8PJ47R1u2rfCpHPZdo8Wr5wyJjuFs9eAbwkdAoQOAUKHAKFDgNAh4OWbQ04aI614vhUmjYre4Vy2K6ecr/ZbXNEhQOgQIHQIEDoECB0ChA4By7fXJp35ddc7bIxNunnipHHXpM965e/MFR0ChA4BQocAoUOA0CFA6BDwyNlrl08waNQwaZvsyimjqSuTxo537R6rXjFeA74ldAgQOgQIHQKEDgFCh4BHttdOu1He33qHUdEku0enp2xQ2l4DfkToECB0CBA6BAgdAoQOAcvPXps0apj0Wt59Q22SFa9z0jjvFa7oECB0CBA6BAgdAoQOAUKHgJfHayv+6X/F3+0epUx6zEljnVPGo1d2b2yu3AJ1RYcAoUOA0CFA6BAgdAgQOgQ8sr122ibP3zpl02z3+GnF57Ji9LZ7y25iD67oECB0CBA6BAgdAoQOAUKHgOVnr51ybtmkbasruz/rK7tvtnnXO4x4f8oVHQKEDgFChwChQ4DQIUDoEPCr22uTbvZ31+4R04qtsBV2j9BOsfs3/4crOgQIHQKEDgFChwChQ4DQIeDl8dpdp9zs7903sa5M2s5b4e77m3S+mptDAt8SOgQIHQKEDgFChwChQ8Aj47VTRjC7N/B2n01216Sz13aPn0656antNeBbQocAoUOA0CFA6BAgdAhYvr22ewQzabPtrkljnRUm/Sbe/bf0hys6BAgdAoQOAUKHAKFDgNAh4OXx2qTtoBVW3Ahw9/Ot3H568jEnja0mvZaVY1VXdAgQOgQIHQKEDgFChwChQ8Cvbq/d/bvdY6RJo8VTxoC7b2L5DjejXMkVHQKEDgFChwChQ4DQIUDoEPDyeG33mOWU59v9mFcmbk09+XyT7B7j/pQrOgQIHQKEDgFChwChQ4DQIeDz68U5waRz0iZtfu0+C23Se5g0CnuH39nK790VHQKEDgFChwChQ4DQIUDoEPCr22uTRiJ3H/Ou3Wd+Xb2HSTecPOUMtd3bjs5eA74ldAgQOgQIHQKEDgFCh4BHzl57h+2nSd7hM9s9stvttN+8KzoECB0ChA4BQocAoUOA0CHg5fHaaeOEv7V7o+odzmWbtNE4acNw0pbkH67oECB0CBA6BAgdAoQOAUKHgEe2165MGpdcWTEGPGXsuPt1nnJzyEk3L3X2GvAtoUOA0CFA6BAgdAgQOgR8fj0wxzplVHRl93jmrkmbUaeNmJ50yuv8wxUdAoQOAUKHAKFDgNAhQOgQMHa8NmlEsXt8OOm9X5n0vU/6jiaO3lzRIUDoECB0CBA6BAgdAoQOAY/cHPLdb+S44u9W2L3ZtvumkpO2JE/jig4BQocAoUOA0CFA6BAgdAhYfvbabndHPis2jiZtVK2w+zM75XuYyBUdAoQOAUKHAKFDgNAhQOgQ8PJ4bfc5W3cf8xSn3Vzw/1nxHnaP0FZ8nhPfgys6BAgdAoQOAUKHAKFDgNAh4JGz14DZXNEhQOgQIHQIEDoECB0ChA4BQocAoUOA0CHgXxSaPveYy7YdAAAAAElFTkSuQmCC" alt="" data-zoomable="true"></p><p>At this point in the contest, you could already sort of make out that the classification results yielded some kind of QR code. But as you can see... it looks nothing like a QR code.</p><p>I tried a few things to clean it up, such as:</p><ol><li>Using DBSCAN instead of K-Means</li><li>Using t-SNE instead of PCA</li><li>Tweaking the number of PCA components</li><li>Tweaking the K-Means parameters</li></ol><p>But all of these didn&#39;t work.</p><h3 id="trying-inference" tabindex="-1">Trying Inference <a class="header-anchor" href="#trying-inference" aria-label="Permalink to “Trying Inference”">​</a></h3><p>So my mind turned instead to the new and fashionable way of doing things: Inference with pre-trained models.</p><p>For the record I think that using pre-trained models is quite the cop-out, but cop-outs are encouraged in CTFs since they allow you to get stuff done with less effort...</p><p>First model I thought of was <a href="https://github.com/openai/CLIP" target="_blank" rel="noreferrer">OpenAI&#39;s CLIP</a> model, since it is designed to match images to text.</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light dracula" style="--shiki-light:#24292e;--shiki-dark:#F8F8F2;--shiki-light-bg:#fff;--shiki-dark-bg:#282A36;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> polars </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> einops</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> matplotlib.pyplot </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> plt</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> PIL</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> Image</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> torch</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> torch.nn.functional </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> softmax</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> clip</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pathlib </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> Path</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> tqdm </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> tqdm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">CSV_PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;"> &#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">images.csv</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">  # Update this path</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">IMG_SHAPE</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">MODEL_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;"> &#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">ViT-B/32</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">CATEGORIES</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">    &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">a photo of a human or person</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">    &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">a photo of a bicycle or PMD</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">model, preprocess </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> clip.load(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">MODEL_NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">device</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">device)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">model.eval()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">df </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl.read_csv(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">CSV_PATH</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">filenames </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> df[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">file_name</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">].to_list()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">X </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> df.drop(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">file_name</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).to_numpy()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">n_samples </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> X.shape[</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">images </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> einops.rearrange(X, </span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">n (h w c) -&gt; n h w c</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">IMG_SHAPE</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">], </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">w</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">IMG_SHAPE</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">], </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">c</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">IMG_SHAPE</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> images.max() </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    images </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> images </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 255.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">text_inputs </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> torch.cat([clip.tokenize(c) </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> c </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> CATEGORIES</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]).to(device)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">with</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> torch.no_grad():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    text_features </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> model.encode_text(text_inputs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    text_features </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">/=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> text_features.norm(</span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=-</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">keepdim</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">predictions, probabilities </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> [], []</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> tqdm(</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">range</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, n_samples, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">BATCH_SIZE</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">), </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">desc</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">Processing</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    batch </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> images[i</span><span style="--shiki-light:#24292E;--shiki-dark:#FF79C6;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">BATCH_SIZE</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    batch_processed </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> img </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> batch:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        img_uint8 </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> (img </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 255</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).astype(np.uint8) </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> img.max() </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> else</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> img.astype(np.uint8)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        pil_img </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> Image.fromarray(img_uint8)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        pil_img </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pil_img.resize((</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">224</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">224</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">), Image.</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">BICUBIC</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        batch_processed.append(preprocess(pil_img))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    image_inputs </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> torch.stack(batch_processed).to(device)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    with</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> torch.no_grad():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        image_features </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> model.encode_image(image_inputs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        image_features </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">/=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> image_features.norm(</span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=-</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">keepdim</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        similarity </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">100.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> image_features </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">@</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> text_features.T)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        probs </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> softmax(similarity, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=-</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        batch_predictions </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> similarity.argmax(</span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=-</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).cpu().numpy()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        batch_probs </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> probs.cpu().numpy()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        predictions.extend(batch_predictions)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        probabilities.extend(batch_probs)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">predictions </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np.array(predictions)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">probabilities </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np.array(probabilities)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># 0 = human/person, others (i.e. 1) = bicycle/PMD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">binary_labels </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np.where(predictions </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">predicted_confidences </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np.array([probabilities[i, pred] </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> i, pred </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;"> enumerate</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(predictions)])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">results_df </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl.DataFrame({</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">    &#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">file_name</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: filenames,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">    &#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">label</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: binary_labels,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># 0 = person, 1 = other (bicycle/PMD)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">    &#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">confidence</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: predicted_confidences,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">    &#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">detailed_prediction</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">CATEGORIES</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">[p] </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> p </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> predictions]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">results_df.write_csv(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">results.csv</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div><p>and with some prompt-engineering, it... kind of worked! <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAD7CAYAAABDsImYAAAAOnRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjEwLjMsIGh0dHBzOi8vbWF0cGxvdGxpYi5vcmcvZiW1igAAAAlwSFlzAAAPYQAAD2EBqD+naQAABTZJREFUeJzt3cFy2zYUQNGo0///ZXfVycZlZTqAH3jP2TqWKNF3sHgB8fr4+Pj4BTzaXz99AcB6QocAoUOA0CFA6BAgdAgQOgQIHQKEDgF/v/sPX6/Xf/7Mf66j5rQerOgQIHQIEDoECB0ChA4BQoeA19QHT5w2vviqp38+ZrGiQ4DQIUDoECB0CBA6BAgdAsaO12Cy08ajVnQIEDoECB0ChA4BQocAoUPA2w+HBH6bOEK7YkWHAKFDgNAhQOgQIHQIEDoEjD177er9TnH1vaz4Pld8Z0/4DLtNHL1Z0SFA6BAgdAgQOgQIHQKEDgFvj9cmjQwmXcvdcdDdsdXd17zr7ghtxejtCff9p1jRIUDoECB0CBA6BAgdAoQOAY97OOTuHVwrrBi9nTYO+qon3PeVrOgQIHQIEDoECB0ChA4BQoeAx43Xnu6Ukc8p11lhRYcAoUOA0CFA6BAgdAgQOgSMPXutbNIDGa9e09/EOazoECB0CBA6BAgdAoQOAUKHgCPPXrtyynVeWTFCu/t7K8ZyK+7RE+77SlZ0CBA6BAgdAoQOAUKHAKFDwJEPh3zCOWKn7PyadJ1PuO8/xYoOAUKHAKFDgNAhQOgQIHQIGDtemzRiOsXunW0rxl3u+xpWdAgQOgQIHQKEDgFChwChQ8AfGa/tPvPryopx0O6HLu7epTVppDVpt9yVU67zX1Z0CBA6BAgdAoQOAUKHAKFDwB8Zr+0eJ+weTe3eFXblCWeh7d4tt/s1J7KiQ4DQIUDoECB0CBA6BAgdAjwc8pvvd3c8M2nENMnu8eiK15z4XVvRIUDoECB0CBA6BAgdAoQOAWPHa1d2Pzxxt0njoCfsersy6dy5lazoECB0CBA6BAgdAoQOAUKHgNfHxK02v2ad57bCpIcnXpl0nbv/VE/boXbFig4BQocAoUOA0CFA6BAgdAhI7V6bdK7XpHPZJpl0ttykXX3fZUWHAKFDgNAhQOgQIHQIEDoEHDleu3LKAwtXjN4mjR1XvN/V7z3pQY4rWNEhQOgQIHQIEDoECB0ChA4Bbz8ccvdunUm7g065liu779Ekk8aHP8WKDgFChwChQ4DQIUDoECB0CHh799rEkcFndu/8mrTT7MqksRyfWznGtaJDgNAhQOgQIHQIEDoECB0Cxj4ccvf5Y5PGSE9/0GF5J92VlX+DVnQIEDoECB0ChA4BQocAoUPA2PHaKeOSSWPASTvpdu8GvPuaV5405rSiQ4DQIUDoECB0CBA6BAgdAsaO1+7avTPq6WfS7R4jrfgMu8dyE1nRIUDoECB0CBA6BAgdAoQOAUeO156wq2jFdd4dve0eP51yjyY9MPS7rOgQIHQIEDoECB0ChA4BQoeAI8druz1hnLfb7u9s0j2aOJazokOA0CFA6BAgdAgQOgQIHQKM137IpB1jTxhNTTqzbSIrOgQIHQKEDgFChwChQ4DQIeBx47WJO4c+c3d0c3cUNul72T3Oe9KY7C4rOgQIHQKEDgFChwChQ4DQIeDI8drTxyWn7Ca7upbdo77d48NJZ+e9w4oOAUKHAKFDgNAhQOgQIHQIOHK8Nmkn1l1PGDE9/f2uTLqWd1jRIUDoECB0CBA6BAgdAoQOAUeO11bYfXbX3dc8bazzVU//fFdWfnYrOgQIHQKEDgFChwChQ4DQIeD1UZ5n8L8mnec26VpOY0WHAKFDgNAhQOgQIHQIEDoEGK9BgBUdAoQOAUKHAKFDgNAhQOgQIHQIEDoECB0ChA4BQocAoUOA0CFA6BAgdAgQOgT8A8iK9NfARfWuAAAAAElFTkSuQmCC" alt="" data-zoomable="true"></p><p>flag: <code>AI2025{5tr1d3s4f3_15_l1t}</code></p><h3 id="challenge-review" tabindex="-1">Challenge Review <a class="header-anchor" href="#challenge-review" aria-label="Permalink to “Challenge Review”">​</a></h3><p>Was a bit annoying, but overall a good beginner challenge. (The writeup elides the fact that prompt engineering took about 30 minutes.)</p><h2 id="limit-theory" tabindex="-1">Limit Theory <a class="header-anchor" href="#limit-theory" aria-label="Permalink to “Limit Theory”">​</a></h2><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula" style="--shiki-light:#24292e;--shiki-dark:#F8F8F2;--shiki-light-bg:#fff;--shiki-dark-bg:#282A36;" tabindex="0" dir="ltr"><code><span class="line"><span>Mr Hojiak has inherited a kaya making machine that his late grandmother invented. This is an advanced machine that can take in the key ingredients of coconut milk, eggs, sugar and pandan leaves and churn out perfect jars of kaya. Unfortunately, original recipe is lost but luckily taste-testing module is still functioning so it may be possible to recreate the taste of the original recipe.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>The machine has three modes experiment, order and taste-test. The experimental mode allows you to put in a small number of ingredients and it will tell you if the mixture added is acceptable. In order to make great jars of kaya, you have to maximise the pandan leaves with a given set of sugar, coconut milk, and eggs to give the best flavor. However, using too many pandan leaves overwhelms the kaya, making it unpalatable.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Production mode with order and taste-test to check the batch quality will use greater quantities, but because of yield loss, the machine will only be able to tell you the amounts of sugar, coconut milk and eggs that will be used before infusing the flavor of pandan leaves. Plan accordingly.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>API: https://limittheory.aictf.sg:5000</span></span>
<span class="line"><span>https://limittheory.aictf.sg</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="reconnaissance-1" tabindex="-1">Reconnaissance <a class="header-anchor" href="#reconnaissance-1" aria-label="Permalink to “Reconnaissance”">​</a></h3><p>We are given a web interface and an API, as well as a <strong>CSV file</strong> of sample experiments. <img src="/assets/limittheory-website.UcVYP3Bs.png" alt="" data-zoomable="true"></p><p>Looking at the CSV file, we see that it contains a list of <code>800</code> experiments with 4 input parameters (coconut milk, eggs, sugar, pandan leaves) and a &#39;PASSED/FAILED&#39; output.</p><div class="language-csv line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csv</span><pre class="shiki shiki-themes github-light dracula" style="--shiki-light:#24292e;--shiki-dark:#F8F8F2;--shiki-light-bg:#fff;--shiki-dark-bg:#282A36;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">coconut_milk,</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">eggs,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#50FA7B;">sugar,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">pandan_leaves,</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">success</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">9.556428757689250,</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">2.5347171131856200,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#50FA7B;">3.442141285965060,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">7132.44787222995,</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">PASSED</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">7.587945476302650,</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">1.5854643368675200,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#50FA7B;">8.458637582367370,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">32418.319308810100,</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">FAILED</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">6.387926357773330,</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">9.539969835280000,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#50FA7B;">4.210779940242300,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">5612.771975694960,</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">PASSED</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">...&lt;all the other rows omitted for sanity&gt;...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Like the (torturously long) description suggests, we have 3 API endpoints:</p><ol><li><code>/experiment</code> - takes in quantities of ingredients from a restricted domain, and returns whether the mixture is &quot;acceptable&quot; or not.</li><li><code>/order</code> - issues ingredient quantities for a production run <strong>outside</strong> the restricted domain of <code>/experiment</code>.</li><li><code>/taste-test</code> - takes in the results of the production run, and returns whether the mixture is &quot;acceptable&quot; or not.</li></ol><p>It wasn&#39;t apparent from the challenge description, but there was also a <strong>pretty severe</strong> rate limit of <code>~120</code> requests every like 10 minutes? Did not appreciate it, but whatever.</p><p>This appears to be a rather classical &quot;fit data and generalize well&quot; machine learning problem; problem being that the model is unknown.</p><h3 id="okay-its-ml-so-can-solve" tabindex="-1">Okay, its ML. So can solve? <a class="header-anchor" href="#okay-its-ml-so-can-solve" aria-label="Permalink to “Okay, its ML. So can solve?”">​</a></h3><p>Given the pitiful number of experiments provided (800), I immediately suspected that the underlying model was something simple, like a <a href="https://en.wikipedia.org/wiki/Logistic_regression" target="_blank" rel="noreferrer">Logistic Regression</a> model.</p><p>Just to be safe, I obviously made sure to augment the data by querying the <code>/experiment</code> endpoint with random values within the allowed domain, and adding those to the dataset:</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light dracula" style="--shiki-light:#24292e;--shiki-dark:#F8F8F2;--shiki-light-bg:#fff;--shiki-dark-bg:#282A36;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Also Jupyter notebook code snippets. Sorry!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> aiohttp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> asyncio</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> random</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> polars </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> tqdm </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> tqdm</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">API_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;"> &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">https://limittheory.aictf.sg:5000/experiment</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">NUM_SAMPLES</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 120</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">OUTPUT_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;"> &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">additional_data_new.csv</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">NPRNG</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np.random.default_rng(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">RANDOM_SAMPLES</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np.concatenate((</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">NPRNG</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">.random((</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">NUM_SAMPLES</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)), </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">NPRNG</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">.triangular(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, (</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">NUM_SAMPLES</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">))), </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Restricted domain from website is [0, 10] for first three parameters, and [0, 50000] for last parameter.</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">RANDOM_SAMPLES</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#FF79C6;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#FF79C6;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">*=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">  # Scale first three parameters to [0, 10]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">RANDOM_SAMPLES</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#FF79C6;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">*=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 50000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">  # Scale last parameter to [0, 50000]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#50FA7B;"> fetch_sample</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">session</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">semaphore</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;">    # Get random parameters to increase dataset support</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    async</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> with</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> semaphore:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        params </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">            &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">coconut_milk</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">RANDOM_SAMPLES</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">            &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">eggs</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">RANDOM_SAMPLES</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">            &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">sugar</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">RANDOM_SAMPLES</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">            &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">pandan_leaves</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">RANDOM_SAMPLES</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">        async</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> with</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> session.post(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">API_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">json</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">params) </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> response:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">            label </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> response.json()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">            params.update(label)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">            await</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> asyncio.sleep(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Rate limit...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> params</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#50FA7B;"> fetch_samples</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">num_samples</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    semaphore </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> asyncio.Semaphore(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Rate limit...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    async</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> with</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> aiohttp.ClientSession() </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> session:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        tasks </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> [fetch_sample(session, i, semaphore) </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(num_samples)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> [</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> task </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> task </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> tqdm(asyncio.as_completed(tasks))]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># New cell</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> time </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sleep</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> tqdm(</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">range</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    samples </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> fetch_samples(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">NUM_SAMPLES</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    pl.DataFrame(samples).write_csv(</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;additional_data_batch_</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1}</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">.csv&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>However, I was quite rudely surprised by the level of precision required to pass the <code>/taste-test</code> endpoint:</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light dracula" style="--shiki-light:#24292e;--shiki-dark:#F8F8F2;--shiki-light-bg:#fff;--shiki-dark-bg:#282A36;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># New cell</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Try to fit a logistic regressor to the data</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sklearn.linear_model </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> LogisticRegression</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sklearn.ensemble </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> RandomForestRegressor</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sklearn.model_selection </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> train_test_split</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sklearn.metrics </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> accuracy_score, classification_report</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> matplotlib </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pyplot </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> plt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">df </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl.read_csv(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">sample_data.csv</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">df </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> df.vstack(pl.read_csv(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">additional_data.csv</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).drop(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">status</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).rename({</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">message</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">success</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">}))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">df </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> df.drop_nulls()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">EPS</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">  1e-8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">y </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> df.select(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">success</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).to_numpy()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">X </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> df.drop(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">success</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).to_numpy()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(X.shape, y.shape)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(df[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">success</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">].value_counts())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># New cell</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sklearn.preprocessing </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> StandardScaler</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Prevent outsized scales from messing with the model...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">scaler </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> StandardScaler()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">X </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> scaler.fit_transform(X)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#50FA7B;"> pf_map</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">): </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    if</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;"> isinstance</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(x, </span><span style="--shiki-light:#005CC5;--shiki-light-font-style:inherit;--shiki-dark:#8BE9FD;--shiki-dark-font-style:italic;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> x</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    elif</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;"> isinstance</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(x, </span><span style="--shiki-light:#005CC5;--shiki-light-font-style:inherit;--shiki-dark:#8BE9FD;--shiki-dark-font-style:italic;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> x </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;"> &#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">PASSED</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> else</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    raise</span><span style="--shiki-light:#005CC5;--shiki-light-font-style:inherit;--shiki-dark:#8BE9FD;--shiki-dark-font-style:italic;"> ValueError</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;Unexpected value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">x</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">y </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-light-font-style:inherit;--shiki-dark:#8BE9FD;--shiki-dark-font-style:italic;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(pf_map, y.flatten()))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">X_tr, X_val, y_tr, y_val </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> train_test_split(X, y, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">test_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">random_state</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">clf </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> LogisticRegression(</span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">random_state</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).fit(X_tr, y_tr)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">Score:</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, clf.score(X_val, y_val))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(clf)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># New cell</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sklearn.metrics </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> roc_curve, auc</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">y_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> clf.decision_function(X_val)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">fpr, tpr, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> roc_curve(y_val, y_score)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">roc_auc </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> auc(fpr, tpr)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.figure()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.plot(fpr, tpr, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">color</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">darkorange</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">lw</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">label</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">ROC curve (area = </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">%0.2f</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> %</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> roc_auc)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.plot([</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">], [</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">], </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">color</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">navy</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">lw</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">linestyle</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.xlim([</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.ylim([</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1.05</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.xlabel(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">False Positive Rate</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.ylabel(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">True Positive Rate</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.title(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">Receiver Operating Characteristic</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.legend(</span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">loc</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">lower right</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">plt.show()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>This is a REALLY GOOD fit. The ROC AUC is <code>0.93</code>, which is near perfect. <img src="/assets/log-reg-roc.r4nkODGx.png" alt="" data-zoomable="true"></p><p>But...</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light dracula" style="--shiki-light:#24292e;--shiki-dark:#F8F8F2;--shiki-light-bg:#fff;--shiki-dark-bg:#282A36;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># New cell</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> requests</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> requests.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">https://limittheory.aictf.sg:5000/order</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># print(&quot;Order response:&quot;, response.json())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">orders </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> response.json()[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">order</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">token </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> response.json()[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">token</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Predict the threshold of Pandan leaves for each order</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># via binary search on logreg decision function</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">preds </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(orders)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> order_name, order </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> orders.items():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    position </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-light-font-style:inherit;--shiki-dark:#8BE9FD;--shiki-dark-font-style:italic;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(order_name.split(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">-</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)[</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    low, high </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">50000</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">):  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># 30 iterations of binary search</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        mid </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> (low </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> high) </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        features </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np.array([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">            order[</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">            order[</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">            order[</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">            mid</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        ]).reshape(</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        features </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> scaler.transform(features)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        decision_value </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> clf.predict(features)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> decision_value </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># i.e. FAIL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">            high </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> mid</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">        else</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">            low </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> mid</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    preds[position] </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">  (low </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> high) </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Submit the order</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(preds)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> requests.post(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">https://limittheory.aictf.sg:5000/taste-test</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">json</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">token</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: token, </span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">result</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: preds})</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">Taste test response:</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, response.json())</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># [15478.281280957162, 7663.008733652532, 10866.082808934152]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Taste test response: {&#39;RESULT&#39;: &#39;Taste-test failed!&#39;}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># ugh...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>So it would seem that we would have to radically revise our approach, perhaps, to model the decision boundary almost perfectly.</p><p>This prompted us to believe that some other kind of <a href="https://en.wikipedia.org/wiki/Linear_model" target="_blank" rel="noreferrer">parameterized linear model</a> was at play here.</p><p>Think about it: How else can you get such a clean decision boundary with so few data points?</p><h3 id="linear-modelling" tabindex="-1">Linear Modelling <a class="header-anchor" href="#linear-modelling" aria-label="Permalink to “Linear Modelling”">​</a></h3><p>So I decided to try and fit a random assortment of linear models to the data, and see which one fit best.</p><p>The key to getting good results with linear models is to do a lot of <a href="https://en.wikipedia.org/wiki/Feature_engineering" target="_blank" rel="noreferrer">feature engineering</a>. <img src="/assets/randombsgo.Cbah44ai.png" alt="" data-zoomable="true"></p><p>Since there are no obvious relationships between the features, I decided to try out a few different transformations (and was prepared to try way more until something stuck):</p><ul><li>Linear (i.e. the original features)</li><li>Ratios (e.g. coconut_milk / eggs)</li><li>Quadratic Forms (e.g. coconut_milk^2, coconut_milk * eggs)</li><li>Logarithmic (e.g. log(coconut_milk))</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light dracula" style="--shiki-light:#24292e;--shiki-dark:#F8F8F2;--shiki-light-bg:#fff;--shiki-dark-bg:#282A36;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Solved again</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> polars </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> np</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> matplotlib </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pyplot </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> plt</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> sklearn.linear_model </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> LinearRegression</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#50FA7B;"> linear_transform</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">c</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">c</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: c,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">e</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: e,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">s</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#50FA7B;"> ratio_transform</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">c</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">    EPS</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 1e-8</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">c/s</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: c </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> (s </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> EPS</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">e/s</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: e </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> (s </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> EPS</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">c/e</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: c </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> (e </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> EPS</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#50FA7B;"> log_transform</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">c</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">    EPS</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 1e-8</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">log_c</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: np.log(c </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> EPS</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">log_e</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: np.log(e </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> EPS</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">log_s</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: np.log(s </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> EPS</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#50FA7B;"> quadratic_form_transform</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">c</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">c2</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: c</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">**</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">e2</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: e</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">**</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">s2</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: s</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">**</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">ce</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: c</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">e,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">cs</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: c</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">s,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">es</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: e</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">s,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">c</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: c,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">e</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: e,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">s</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">df </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl.read_csv(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">scaling_results.csv</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">df </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> df.drop([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">    &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">base_idx</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">scale_factor</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">sum</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> trf </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> [linear_transform, ratio_transform, log_transform, quadratic_form_transform]:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    trf_df </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl.DataFrame({</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">        **</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">trf(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">            df[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">coconut</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">            df[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">eggs</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">], </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">            df[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">sugar</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        ),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">        &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">threshold</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: df[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">threshold</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    X </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> trf_df.drop(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">threshold</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    y </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> trf_df.select(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">threshold</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">Transform:</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, trf.</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">__name__</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">X shape:</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, X.shape, </span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">y shape:</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, y.shape)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    model </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> LinearRegression().fit(X, y)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">R^2:</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, model.score(X, y))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">MSE:</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, np.mean((model.predict(X) </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> y)</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">**</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;Names: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">model.feature_names_in_</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;Coefficients: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">model.coef_</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">, Intercept: </span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">model.intercept_</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><p>which yielded the following results:</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula" style="--shiki-light:#24292e;--shiki-dark:#F8F8F2;--shiki-light-bg:#fff;--shiki-dark-bg:#282A36;" tabindex="0" dir="ltr"><code><span class="line"><span>Transform: linear_transform</span></span>
<span class="line"><span>X shape: (113, 3) y shape: (113, 1)</span></span>
<span class="line"><span>R^2: 0.9041112446001132</span></span>
<span class="line"><span>MSE: 1862281.5837982614</span></span>
<span class="line"><span>Names: [&#39;c&#39; &#39;e&#39; &#39;s&#39;]</span></span>
<span class="line"><span>Coefficients: [[1008.06767668  320.96307759 1122.20767127]], Intercept: [-5301.56386984]</span></span>
<span class="line"><span>Transform: ratio_transform</span></span>
<span class="line"><span>X shape: (113, 3) y shape: (113, 1)</span></span>
<span class="line"><span>R^2: 0.085363747702359</span></span>
<span class="line"><span>MSE: 17763399.27893326</span></span>
<span class="line"><span>Names: [&#39;c/s&#39; &#39;e/s&#39; &#39;c/e&#39;]</span></span>
<span class="line"><span>Coefficients: [[-293.16913969  -23.31295561  112.94870038]], Intercept: [4931.46113844]</span></span>
<span class="line"><span>Transform: log_transform</span></span>
<span class="line"><span>X shape: (113, 3) y shape: (113, 1)</span></span>
<span class="line"><span>R^2: 0.7198056157049848</span></span>
<span class="line"><span>MSE: 5441731.301863531</span></span>
<span class="line"><span>Names: [&#39;log_c&#39; &#39;log_e&#39; &#39;log_s&#39;]</span></span>
<span class="line"><span>Coefficients: [[2935.45798492 1132.50190739 2960.3670994 ]], Intercept: [-3014.31000086]</span></span>
<span class="line"><span>Transform: quadratic_form_transform</span></span>
<span class="line"><span>X shape: (113, 9) y shape: (113, 1)</span></span>
<span class="line"><span>R^2: 0.9999999999998537</span></span>
<span class="line"><span>MSE: 2.841802828936823e-06</span></span>
<span class="line"><span>Names: [&#39;c2&#39; &#39;e2&#39; &#39;s2&#39; &#39;ce&#39; &#39;cs&#39; &#39;es&#39; &#39;c&#39; &#39;e&#39; &#39;s&#39;]</span></span>
<span class="line"><span>Coefficients: [[-2.19481179e-05  1.80340482e-05  3.24891983e-05  4.99999541e+01</span></span>
<span class="line"><span>   2.00000001e+02  2.00000186e+01  4.72554194e-04 -1.61247451e-05</span></span>
<span class="line"><span>  -3.75376121e-04]], Intercept: [-0.00063777]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>Bingo. The quadratic form transformation yielded a near-perfect fit, with an <code>R^2</code> of <code>0.9999999999998537</code>.</p><p>Let&#39;s try it out:</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light dracula" style="--shiki-light:#24292e;--shiki-dark:#F8F8F2;--shiki-light-bg:#fff;--shiki-dark-bg:#282A36;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> requests</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">best_fn </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> quadratic_form_transform</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">trf_df </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> pl.DataFrame({</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    **</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">best_fn(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        df[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">coconut</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        df[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">eggs</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">], </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">        df[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">sugar</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    ),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">    &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">threshold</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: df[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">threshold</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">X </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> trf_df.drop(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">threshold</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).to_numpy()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">y </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> trf_df.select(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">threshold</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">).to_numpy()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">model </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> LinearRegression().fit(X, y)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#50FA7B;"> predict_pandan_threshold</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">coconut</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">eggs</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">sugar</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> model.predict(np.array([[</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">        *</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">best_fn(coconut, eggs, sugar).values()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    ]])).item()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> requests.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">https://limittheory.aictf.sg:5000/order</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">orders </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> response.json()[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">order</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">token </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> response.json()[</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">token</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">preds </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(orders)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> order_name, order </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> orders.items():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    position </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#005CC5;--shiki-light-font-style:inherit;--shiki-dark:#8BE9FD;--shiki-dark-font-style:italic;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(order_name.split(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">-</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">)[</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">    preds[position] </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> predict_pandan_threshold(order[</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">], order[</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">], order[</span><span style="--shiki-light:#005CC5;--shiki-dark:#BD93F9;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Submit the order</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(preds)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;"> requests.post(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">https://limittheory.aictf.sg:5000/taste-test</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic;">json</span><span style="--shiki-light:#D73A49;--shiki-dark:#FF79C6;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">token</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: token, </span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">result</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">: preds})</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8BE9FD;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#F1FA8C;">Taste test response:</span><span style="--shiki-light:#032F62;--shiki-dark:#E9F284;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#F8F8F2;">, response.json())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># [34289.220314496735, 19659.9614213712, 21017.5142869692]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6272A4;"># Taste test response: {&#39;FLAG&#39;: &#39;AI2025{L1m1t_Th3ory_4_Kaya_T0ast}&#39;}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>And just like that, we win!</p><p>flag: <code>AI2025{L1m1t_Th3ory_4_Kaya_T0ast}</code></p><h3 id="a-quick-disclaimer" tabindex="-1">A Quick Disclaimer <a class="header-anchor" href="#a-quick-disclaimer" aria-label="Permalink to “A Quick Disclaimer”">​</a></h3><p>Yes, I made it sound super easy. But in reality this was a 3-hour process of:</p><ul><li>coming up with ideas</li><li>implementing them (with Copilot. I know I said no LLMs, but technically it only provides completions, not solutions)</li><li>testing them</li><li>failing</li><li>repeat</li></ul><p>So I got a little tilted when this happened: <img src="/assets/vincent-solve.CvdxBvVS.png" alt="" data-zoomable="true"><img src="/assets/vincent-solve-2.tyQlKk5G.png" alt="" data-zoomable="true"></p><p>(jk, well done Vincent!)</p><p>I guess there&#39;s something to be said here about:</p><ol><li>experience and intuition on datasets</li><li>being able to rapidly prototype and test ideas</li><li>luck</li><li>the gulf between challenge setters&#39; and solvers&#39; perceptions of difficulty</li></ol><p>But they won&#39;t be in this writeup. So there.</p><h3 id="challenge-review-1" tabindex="-1">Challenge Review <a class="header-anchor" href="#challenge-review-1" aria-label="Permalink to “Challenge Review”">​</a></h3><p>For all the pain I went through only to be outdone by Vincent (&amp; Chad Jippity), I have to say that this was an interesting challenge that presented me a rare opportunity to do Exploratory Data Analysis.</p><p>Feature engineering is also rather underrated in favor of architectural improvements and &quot;throwing more compute and data at the problem&quot;, so it was nice to be reminded of its importance.</p><p>However, I would have liked if the model was a bit more complex and noisy and the checker a bit less strict, so that more models could have worked. But I don&#39;t know if that would have made it Jippity-able anyways...</p><h3 id="post-script-some-nice-plots" tabindex="-1">Post-Script: Some Nice Plots <a class="header-anchor" href="#post-script-some-nice-plots" aria-label="Permalink to “Post-Script: Some Nice Plots”">​</a></h3><p>I spent 3 hours querying the <code>/experiment</code> endpoint, getting rate-limited to no tomorrow, WHILE STILL trying to fit various models to the data. So I might as well show you some of the plots that transpired from all that messing around... <img src="/assets/scaling-laws-analysis.BRhsMKnH.png" alt="" data-zoomable="true"><img src="/assets/randombsgo.Cbah44ai.png" alt="" data-zoomable="true"></p></div></div></main><footer class="VPDocFooter" data-v-7011f0d8 data-v-e257564d><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"about-me_index.md\":\"te53mTWO\",\"api-examples.md\":\"DwEcywL5\",\"blog_index.md\":\"D-unYAPw\",\"index.md\":\"DAXXWD6C\",\"markdown-examples.md\":\"CfG2qhY4\",\"writeups_2021-03-02-dso-nus-ctf.md\":\"Ct7M1uPH\",\"writeups_2021-03-07-whitehacks.md\":\"CQZgBOIM\",\"writeups_2021-03-14-ctf-sg.md\":\"Bf9pJ35Q\",\"writeups_2021-03-27-umass-ctf.md\":\"BUH7RWj8\",\"writeups_2021-04-08-angstromctf-2021.md\":\"CVcaRzf1\",\"writeups_2021-06-20-hsctf-8.md\":\"BMAg6LIy\",\"writeups_2021-06-26-cddc-2021.md\":\"C1dwqn4g\",\"writeups_2021-09-05-cyberthon.md\":\"AXKiOfEF\",\"writeups_2025-10-13-govtech-ai-ctf-2025-quals.md\":\"6cLPK43v\",\"writeups_index.md\":\"gNWKlo5D\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"N00bcak's Purple Cave\",\"description\":\"Blogging Things When I Feel Like It\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"About\",\"link\":\"/about-me\"},{\"text\":\"CTF Writeups\",\"link\":\"/writeups\"},{\"text\":\"Blog\",\"link\":\"/blog\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/N00bcak\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>